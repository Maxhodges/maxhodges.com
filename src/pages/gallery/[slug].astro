---
import { getCollection } from "astro:content";
import { getImage } from "astro:assets";
import SiteLayout from "../../layouts/SiteLayout.astro";
import GallerySlider from "../../components/GallerySlider.svelte";

export async function getStaticPaths() {
  const galleries = await getCollection("galleries");
  return galleries.map((gallery) => ({
    params: { slug: gallery.id },
    props: { gallery },
  }));
}

const { gallery } = Astro.props;
const widths = [640, 1200, 1920, 2560];
const sizes = "(max-width: 768px) 92vw, 100vw";

const images = await Promise.all(
  gallery.data.images.map(async (image) => {
    const avif = await getImage({ src: image.src, widths, format: "avif" });
    const webp = await getImage({ src: image.src, widths, format: "webp" });
    const fallback = await getImage({ src: image.src, widths, format: "jpeg" });

    return {
      alt: image.alt,
      sources: [
        { type: "image/avif", srcset: avif.srcSet.attribute, sizes },
        { type: "image/webp", srcset: webp.srcSet.attribute, sizes },
      ],
      fallback: {
        src: fallback.src,
        srcset: fallback.srcSet.attribute,
        sizes,
        width: fallback.attributes.width,
        height: fallback.attributes.height,
      },
    };
  })
);
---

<SiteLayout title={`Max Hodges â€” ${gallery.data.title}`} breadcrumb={`Home / ${gallery.data.title}`}>
  <section class="grid gap-10">
    <div class="flex flex-wrap items-end justify-between gap-6">
      <div>
        <h1 class="font-[var(--font-display)] text-4xl leading-tight sm:text-5xl">
          {gallery.data.title}
        </h1>
        <p class="mt-3 max-w-xl text-sm uppercase tracking-[0.2em] text-[color:var(--sea)]">
          Immersive sequence, navigable with arrows.
        </p>
      </div>
      <div class="rounded-full border border-[color:var(--rust)] px-4 py-2 text-xs uppercase tracking-[0.3em] text-[color:var(--rust)]">
        Series
      </div>
    </div>

    <GallerySlider images={images} client:load />
  </section>
</SiteLayout>
